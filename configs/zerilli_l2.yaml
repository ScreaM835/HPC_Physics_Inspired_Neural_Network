# Zerilli (even parity) l=2 experiment config in units where M=1.
experiment:
  name: zerilli_l2

physics:
  M: 1.0
  l: 2
  potential: zerilli   # zerilli | regge-wheeler
  pde_sign: standard   # standard: phi_tt - phi_xx + V phi = 0

domain:
  xmin: -50.0
  xmax: 150.0
  tmin: 0.0
  tmax: 50.0

initial_data:
  A: 1.0
  x0: 4.0
  sigma: 5.0
  # The target paper prints  dPhi/dt = 2 * ((x-x0)^2 / sigma^2) * Phi
  # If you want the physically-standard outgoing Gaussian pulse, set `velocity_profile: outgoing`.
  velocity_profile: outgoing   # outgoing | paper

fd:
  dx: 0.2
  dt: 0.1
  # If dx and dt are given, Nx and Nt are derived to span [xmin,xmax] and [tmin,tmax].
  # (This resolves the minor "Nx vs dx" ambiguity by honoring dx exactly.)
  scheme: rk4_mol

pinn:
  seed: 1234
  dtype: float64

  # Memory safeguard: compute residual terms in chunks to avoid very large autograd graphs.
  chunk_size: 4096   # set 0 for full-batch residual evaluation

  # training points
  Nr: 32000
  Ni: 800
  Nb: 400

  # network
  hidden_layers: [80, 40, 20, 10]
  activation: tanh
  output_transform: tanh_bound  # tanh_bound | none

  # loss weights λ = [Lr, Lrx, Lrt, Lic, Liv, Lbl, Lbr]
  # Baseline: equal weights; gradient balancing (Wang et al. 2021) adjusts
  # them dynamically during the Adam phase.
  lambda: [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0]

  # Causal training (Wang et al., 2022 — arXiv:2203.07404)
  # Disabled for now. Was essentially inactive in previous run (w_min=0.9996).
  # Can be re-enabled after DeepXDE migration is validated.
  causal:
    enabled: false
    epsilon: 50.0    # causality strictness (0 = standard PINN, large = strict)
    n_slices: 20     # number of temporal bins

  # Gradient balancing (Wang, Teng & Perdikaris 2021)
  # Dynamically adjusts loss weights so per-term gradient magnitudes match.
  # Active during Adam phase only; weights are frozen for L-BFGS.
  gradient_balancing:
    enabled: true
    period: 100      # recompute weights every N Adam steps
    alpha: 0.9       # EMA decay (higher = slower adaptation)

  # optimizers
  adam:
    lr: 1.0e-3
    iters: 10000
    resample_period: 100

  lbfgs:
    iters: 15000
    resample_period: 100

evaluation:
  xq: 10.0   # sampling point for ringdown / QNM extraction

qnm:
  # time window used for fitting / FFT (to reduce initial transient)
  t_start: 10.0
  t_end: 50.0
